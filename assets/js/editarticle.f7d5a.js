webpackJsonp([3],{1235:function(e,t,a){"use strict";function n(e){return function(){var t=e.apply(this,arguments);return new Promise(function(e,a){function n(r,i){try{var s=t[r](i),c=s.value}catch(e){return void a(e)}if(!s.done)return Promise.resolve(c).then(function(e){n("next",e)},function(e){n("throw",e)});e(c)}return n("next")})}}function r(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function s(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function c(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var o=a(0),l=a.n(o),u=a(98),p=a(99),f=(a.n(p),a(76)),d=a.n(f),g=a(518),v=a.n(g),h=a(42),m=(a.n(h),a(307)),b=(a.n(m),a(191)),y=a.n(b),S=a(4),k=a.n(S),w=(a(310),a(516)),x=a(308),E=a(124),_=a.n(E),O=(a(311),a(312)),T=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var n in a)Object.prototype.hasOwnProperty.call(a,n)&&(e[n]=a[n])}return e},j=function(){function e(e,t){for(var a=0;a<t.length;a++){var n=t[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,a,n){return a&&e(t.prototype,a),n&&e(t,n),t}}(),P=null,R=function(e){function t(e,a){i(this,t);var n=s(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,a));C.call(n);var r=e.article,c=r.title,o=r.content;return n.state={title:c,content:o,tagsSelected:e.tagsSelected,message:"",active:!1,editing:!0},n}return c(t,e),j(t,[{key:"componentDidMount",value:function(){P=new Editor,P.render(),this.props.router.setRouteLeaveHook(this.props.route,this.routerWillLeave)}},{key:"componentWillReceiveProps",value:function(e){var t=e.article,a=e.tagsSelected;1===e.mode&&t.title&&(P.codemirror.setValue(t.content),this.setState(T({},this.state,{tagsSelected:a,title:t.title,content:t.content})))}},{key:"render",value:function(){var e=this.state,t=e.title,a=e.content,n=e.tagsSelected,i=e.message,s=e.active,c=k()(_.a.mask,r({},_.a.active,this.props.active)),o=k()(_.a.fullMask,r({},_.a.active,this.props.fetching));return l.a.createElement("div",null,l.a.createElement(d.a,{label:"标题",onChange:this.changeTitle,value:t}),l.a.createElement("div",{style:{position:"relative"}},l.a.createElement(v.a,{direction:"down",allowCreate:!0,showSelectedWhenNotInSource:!0,label:"添加标签",source:this.props.tags,onChange:this.editTag,value:n}),l.a.createElement("div",{className:c},l.a.createElement(y.a,{className:_.a.wh,type:"circular",mode:"indeterminate"}))),l.a.createElement("div",null,l.a.createElement("textarea",{defaultValue:a})),l.a.createElement(h.Button,{label:"保存",raised:!0,onClick:this.saveArticle}),l.a.createElement("div",{className:o},l.a.createElement(y.a,{type:"circular",mode:"indeterminate"})),l.a.createElement(m.Snackbar,{action:"Dismiss",label:i,active:s,timeout:3e3,onTimeout:this.SnackbarTimeout}))}}]),t}(o.Component),C=function(){var e=this;this.routerWillLeave=function(){if(e.state.editing)return"当前为编辑状态，确定要离开么？"},this.editTag=function(){var t=n(regeneratorRuntime.mark(function t(a){var n,r,i,s,c,o;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(void 0!==(n=a[0])){t.next=4;break}return e.setState(T({},e.state,{tagsSelected:a})),t.abrupt("return");case 4:r=e.props.tags,i=!1,s="",t.t0=regeneratorRuntime.keys(r);case 8:if((t.t1=t.t0()).done){t.next=16;break}if(c=t.t1.value,n!==c&&n!==r[c]){t.next=14;break}return i=!0,s=c,t.abrupt("break",16);case 14:t.next=8;break;case 16:if(!i){t.next=20;break}return a.splice(0,1,s),e.setState(T({},e.state,{tagsSelected:a})),t.abrupt("return");case 20:return t.prev=20,t.next=23,e.props.addTag(n);case 23:if(o=t.sent,o.type!==O.a){t.next=26;break}throw new Error(o.message);case 26:a.splice(0,1,o.data.data._id),e.setState(T({},e.state,{tagsSelected:a})),t.next=33;break;case 30:t.prev=30,t.t2=t.catch(20),e.setState(T({},e.state,{active:!0,message:t.t2.message}));case 33:case"end":return t.stop()}},t,e,[[20,30]])}));return function(e){return t.apply(this,arguments)}}(),this.changeTitle=function(t){e.setState(T({},e.state,{title:t}))},this.saveArticle=n(regeneratorRuntime.mark(function t(){var a,n,r,i,s,c,o;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(a=e.state.title.trim(),n=P.codemirror.getValue().trim(),r=e.state.tagsSelected,i="",""===a?i="标题不能为空":a.length<5||a.length>20?i="标题太长或太短":""===n&&(i="文章内容不能为空"),!i){t.next=8;break}return e.setState(T({},e.state,{active:!0,message:i})),t.abrupt("return");case 8:if(s=!1,c=null,t.prev=10,o={title:a,content:n,tags:r},0!==e.props.mode){t.next=18;break}return t.next=15,e.props.saveArticle(o);case 15:c=t.sent,t.next=22;break;case 18:return o.id=e.props.article._id,t.next=21,e.props.editArticle(o);case 21:c=t.sent;case 22:if(!c.type.includes("FAILURE")){t.next=24;break}throw new Error(c.message);case 24:c.type.includes("SUCCESS")&&(s=!0,i=c.data.msg,P.codemirror.setValue(""),e.setState(T({},e.state,{title:"",content:"",tagsSelected:[],active:s,message:i,editing:!1})),setTimeout(function(){p.browserHistory.push("/admin/article")},1e3)),t.next=32;break;case 27:t.prev=27,t.t0=t.catch(10),s=!0,i=t.t0.message,e.setState(T({},e.state,{active:s,message:i}));case 32:case"end":return t.stop()}},t,e,[[10,27]])})),this.SnackbarTimeout=function(){e.setState(T({},e.state,{active:!1}))}},A=function(e){var t=e.articles,a=e.tags,n=e.routing.locationBeforeTransitions.pathname.split("/"),r=n[3],i={};if(a.list.forEach(function(e){i[e._id]=e.tag}),"create"===r)return{article:{title:"",content:""},tags:i,fetching:t.isFetching,active:a.isFetching,tagsSelected:[],mode:0};var s={title:"",content:""},c=t.list,o=[],l=n[4];if(0!==c.length)for(var u=0;u<c.length;u++)if(c[u]._id===l){s.title=c[u].title,o=c[u].tags,s.content=c[u].content;break}return s._id=l,{article:s,tags:i,fetching:t.isFetching,active:a.isFetching,tagsSelected:o,mode:1}};t.default=a.i(p.withRouter)(a.i(u.connect)(A,{addTag:w.a,saveArticle:x.a,editArticle:x.b})(R))}});